<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stack Attack - Web (iOS Style)</title>
<style>
  body { margin:0; overflow:hidden; background:black; font-family: Arial; }
  canvas { display:block; }
  #ui { position: fixed; top: 10px; left: 10px; color:white; z-index:10; }
  button { margin: 4px; padding: 6px 10px; font-size: 14px; }
</style>
</head>
<body>
<div id="ui">
  <div id="info"></div>
  <button onclick="togglePause()">Pause</button>
  <button onclick="toggleSound()">Sound</button>
  <button onclick="retry()">Retry</button>
</div>
<canvas id="game"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
const { Engine, Render, Runner, World, Bodies, Body, Events } = Matter;
const canvas = document.getElementById('game');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let engine = Engine.create();
let world = engine.world;
engine.gravity.y = 1;

let blocks = [];
let currentBlock = null;
let direction = 1;
let ground;
let score = 0;
let level = 1;
let maxLevel = 7;
let targetHeight = 300;
let paused = false;
let soundOn = true;
let gameState = 'menu';

const render = Render.create({
  canvas,
  engine,
  options: { width: canvas.width, height: canvas.height, wireframes:false, background:'#6bb6e5' }
});
Render.run(render);
const runner = Runner.create();
Runner.run(runner, engine);

function setupGround(){
  ground = Bodies.rectangle(canvas.width/2, canvas.height-20, canvas.width, 40, { isStatic:true });
  World.add(world, ground);
}

function spawnMovingBlock(){
  const w = blocks.length ? blocks[blocks.length-1].bounds.max.x - blocks[blocks.length-1].bounds.min.x : 80;
  currentBlock = Bodies.rectangle(canvas.width/2, 80, w, 20, { isStatic:true });
  World.add(world, currentBlock);
}

function dropBlock(){
  if(!currentBlock || paused || gameState!=='playing') return;
  Body.setStatic(currentBlock, false);
  blocks.push(currentBlock);
  currentBlock = null;
}

canvas.addEventListener('click',()=>{
  if(gameState==='menu') startGame(5);
  else if(gameState==='playing') dropBlock();
  else if(gameState==='lose') startGame(level);
});

Events.on(engine,'beforeUpdate',()=>{
  if(currentBlock && !paused){
    Body.setPosition(currentBlock, {
      x: currentBlock.position.x + 3 * direction,
      y: currentBlock.position.y
    });
    if(currentBlock.position.x > canvas.width - 40 || currentBlock.position.x < 40) direction *= -1;
  }
});

Events.on(engine,'afterUpdate',()=>{
  if(paused || gameState!=='playing') return;

  let highest = Math.min(...blocks.map(b=>b.position.y), canvas.height);
  if(canvas.height-highest > targetHeight){
    level++;
    score += 500;
    targetHeight += 250;
    if(level > maxLevel) gameState = 'victory';
  }

  blocks.forEach(b=>{
    if(b.position.y > canvas.height + 300) gameState='lose';
  });

  if(!currentBlock && gameState==='playing') spawnMovingBlock();
});

function togglePause(){ paused=!paused; engine.enabled=!paused; }
function toggleSound(){ soundOn=!soundOn; alert(soundOn?'Sound ON':'Sound OFF'); }
function retry(){ startGame(level); }

function startGame(lvl){
  World.clear(world,false);
  engine = Engine.create();
  engine.gravity.y = 1 + lvl*0.1;
  world = engine.world;
  Runner.run(runner,engine);

  blocks=[];
  currentBlock=null;
  score=0;
  level=lvl;
  targetHeight = 300 + lvl*200;
  gameState='playing';

  setupGround();
  spawnMovingBlock();
}

function drawOverlay(text){
  const ctx = render.context;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='white';
  ctx.font='42px Arial';
  ctx.textAlign='center';
  ctx.fillText(text, canvas.width/2, canvas.height/2);
}

(function loop(){
  requestAnimationFrame(loop);
  document.getElementById('info').innerText = `Level ${level} | Score ${score}`;
  if(gameState==='menu') drawOverlay('STACK ATTACK – Click to Start');
  if(gameState==='victory') drawOverlay('PRINCESS SAVED!');
  if(gameState==='lose') drawOverlay('YOU LOSE – Click to Retry');
})();
</script>
</body>
</html>




